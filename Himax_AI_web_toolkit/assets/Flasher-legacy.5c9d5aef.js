System.register(["./index-legacy.8f5c53d6.js","./index-legacy.3b160781.js"],(function(e,t){"use strict";var s,r,i,a,n;return{setters:[e=>{s=e.u,r=e.a},e=>{i=e.u,a=e.p,n=e.m}],execute:function(){e("F",class{isNeedConnectDevice=!0;isNeedResetDevice=!0;espLoader=null;transport=null;device=null;deviceStore;espLoaderTerminal;constructor(){const{device:e,term:t}=s();this.device=e.value,this.deviceStore=i(),this.espLoaderTerminal={clean(){t.clear()},writeLine(e){t.writeln(e)},write(e){t.write(e)}}}async espLoaderConnect(){if(this.deviceStore.deviceStatus!==a.EspConnected&&await(this.device?.esploaderConnect(this.espLoaderTerminal)),this.espLoader=this.device?.esploader??null,this.transport=this.device?.transport??null,!this.espLoader||!this.transport)throw new Error(n.global.t("workplace.serial.no.port"))}async writeFlashBefore(){await this.espLoaderConnect()}async onWriteFlash(e){try{const t={fileArray:e,flashSize:"keep",eraseAll:!1,compress:!0,reportProgress:(e,t,s)=>{console.log("written ",e," file:",t/s*100),this.deviceStore.setFlashProgress(`${Math.floor(t/s*100)}%`)}};return await(this.espLoader?.write_flash(t)),!0}catch(t){return console.error("An error occurred during the burning process:",t),this.espLoaderTerminal.writeLine(`Error: ${t.message}`),!1}}async onResetDevice(){await(this.transport?.setDTR(!1)),await new Promise((e=>{setTimeout(e,100)})),await(this.transport?.setDTR(!0))}async onConnectDevice(){this.deviceStore.deviceStatus!==a.SerialConnected&&await(this.device?.connect())}async onEraseFlashBefore(){await this.espLoaderConnect()}async onEraseFlash(){return await(this.espLoader?.erase_flash()),this.deviceStore.setCurrentAvailableModel(!1),!0}}),e("a",class{isNeedConnectDevice=!1;isNeedResetDevice=!0;device=null;deviceStore;constructor(){const{device:e}=s();this.device=e.value,this.deviceStore=i()}async writeFlashBefore(){await this.onConnectDevice()}async onWriteFlash(e){try{for(let t=0;t<e.length;t+=1){const s=e[t];await(this.device?.flash(s.data,s.address))}return await r(2e3),!0}catch(t){return console.error("An error occurred during the burning process:",t),!1}}async onResetDevice(){await(this.device?.hardReset()),await r(500)}async onConnectDevice(){this.deviceStore.deviceStatus!==a.SerialConnected&&await(this.device?.connect())}async onEraseFlashBefore(){await this.onConnectDevice()}async onEraseFlash(){return await(this.device?.eraseFlash()),this.deviceStore.setCurrentAvailableModel(!1),!0}})}}}));
